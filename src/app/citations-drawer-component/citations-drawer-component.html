<!-- Overlay -->
<div class="fixed inset-0 z-40" [class.pointer-events-none]="!open">
    <div class="absolute inset-0 bg-black/30 transition-opacity" [class.opacity-0]="!open" [class.opacity-100]="open"
        (click)="close.emit()"></div>

    <!-- Panel -->
    <!-- aside ... -->
    <aside class="absolute right-0 top-0 h-full w-full md:w-[720px] bg-white shadow-xl border-l border-slate-200
         transition-transform duration-300" [class.translate-x-full]="!open" [class.translate-x-0]="open"
        [attr.aria-hidden]="!open">

        <header class="flex items-center justify-between px-4 py-3 border-b border-slate-200">
            <h3 class="text-sm font-semibold text-slate-800">Sources</h3>
            <button type="button" class="rounded-md border border-slate-200 px-2 py-1 text-xs hover:bg-slate-50"
                (click)="close.emit()">Close</button>
        </header>

        <!-- Chips row stays the same -->

        <!-- Content -->
        <div class="grid grid-cols-1 md:grid-cols-2 h-full">
            <!-- Snippet -->
            <div class="p-4 overflow-auto bg-white">
                @if (citations.length > 0) {
                @let c = citations[activeIndex];
                <div class="text-[11px] uppercase text-slate-500 mb-2">Snippet</div>
                <p class="text-sm text-slate-800 whitespace-pre-line leading-6">
                    {{ c.snippet }}
                </p>
                <div class="mt-3 text-xs text-slate-500">
                    <span class="font-medium">{{ c.title }}</span>
                    â€¢ Page {{ c.page }}
                </div>
                } @else {
                <div class="text-xs text-slate-500">No citations.</div>
                }
            </div>

            <!-- PDF Preview (fills all remaining height) -->
            <div class="p-4 border-t md:border-t-0 md:border-l border-slate-200 overflow-hidden bg-slate-50
              flex flex-col h-full">
                @if (citations.length > 0) {
                @let c = citations[activeIndex];

                <div class="flex-1 min-h-0 rounded-lg border border-slate-200 bg-white overflow-hidden">
                    <app-pdf-preview-component [src]="c.pdfUrl" [page]="c.page" [height]="'100%'"> <!-- key -->
                    </app-pdf-preview-component>
                </div>
                }
            </div>
        </div>
    </aside>
</div>