<section class="flex flex-col h-full bg-white border border-slate-200 rounded-2xl overflow-hidden">
    <!-- Header -->
    <header class="px-4 md:px-6 py-3 border-b border-slate-200 bg-slate-50">
        <div class="flex items-center gap-2">
            <svg class="w-5 h-5 text-indigo-600" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M7 3h7l5 5v13a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1z" stroke="currentColor"
                    stroke-width="1.5" stroke-linejoin="round" />
                <path d="M14 3v5h5" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round" />
            </svg>
            <h3 class="text-sm md:text-base font-medium truncate">
                Chatting with: <span class="font-semibold">{{ documentName }}</span>
            </h3>
        </div>
    </header>

    <!-- Messages -->
    <div #scroller class="flex-1 overflow-y-auto p-4 md:p-6 space-y-4">
        @for (msg of messages; track $index) {
        @if (msg.role === 'ai') {
        <div class="flex items-start gap-3 max-w-3xl">
            <div class="flex-none">
                <div class="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center">
                    <svg class="w-4 h-4 text-slate-700" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                        <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.5" />
                        <circle cx="9" cy="11" r="1" fill="currentColor" />
                        <circle cx="15" cy="11" r="1" fill="currentColor" />
                        <path d="M9 15h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                    </svg>
                </div>
            </div>
            <div class="flex-1">
                <div class="inline-block rounded-2xl px-4 py-3 bg-slate-100 text-slate-800">
                    <p class="text-sm leading-relaxed whitespace-pre-line">{{ msg.content }}</p>
                </div>
            </div>
        </div>
        } @else {
        <div class="flex items-start gap-3 justify-end">
            <div class="flex-1"></div>
            <div class="max-w-3xl">
                <div class="inline-block rounded-2xl px-4 py-3 bg-indigo-600 text-white">
                    <p class="text-sm leading-relaxed whitespace-pre-line">{{ msg.content }}</p>
                </div>
            </div>
            <div class="flex-none">
                <div
                    class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 text-xs font-semibold">
                    You</div>
            </div>
        </div>
        }
        }

        @if (isTyping) {
        <div class="flex items-center gap-2 text-slate-600" aria-live="polite">
            <div class="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center">
                <svg class="w-4 h-4 text-slate-700" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.5"></circle>
                </svg>
            </div>
            <div class="flex items-center gap-1">
                <span class="text-sm">AI is typing</span>
                <span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span>
            </div>
        </div>
        }
    </div>

    <!-- Input -->
    <form (submit)="onSend()" class="border-t border-slate-200 p-3 md:p-4 bg-white" aria-label="Chat input">
        <div class="relative">
            <input [(ngModel)]="question" name="question" type="text" [disabled]="isTyping"
                [attr.aria-disabled]="isTyping" class="w-full rounded-full border border-slate-300 px-4 py-3 pr-12 text-sm transition
               placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500
               disabled:opacity-60 disabled:cursor-not-allowed" placeholder="Ask a question about the document..."
                autocomplete="off" />

            <button type="submit" [disabled]="isSendDisabled" [attr.aria-disabled]="isSendDisabled" class="absolute right-1.5 top-1/2 -translate-y-1/2 inline-flex items-center justify-center
               w-9 h-9 rounded-full bg-indigo-600 text-white transition
               hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500
               disabled:opacity-60 disabled:cursor-not-allowed" aria-label="Send" title="Send">
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <path d="M4 12l15-8-4 16-3-6-8-2z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round">
                    </path>
                </svg>
            </button>
        </div>
        <div class="block md:hidden pt-[env(safe-area-inset-bottom)]"></div>
    </form>
</section>